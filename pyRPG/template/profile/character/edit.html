{% extends 'base.html' %}
{% block content %}
<div class="container-fluid">
  <div class="row">
    <div class="col-9">
      <!-- information box  -->
      <div class="row">
        <div class="col-12">
          <div class="card">
            {% include 'profile/character/info/information.html' %}
          </div>
        </div>
      <!-- end information box -->
      <!-- ability box -->
        <div class="col-12">
          <div class="card">
            {% include 'profile/character/info/abilities.html' %}
          </div>
        </div>
      </div>
      <!-- end ability box -->
      <div class="row">
        <div class="col-4">
          <div class="character-actions">
            {% include 'profile/character/info/actions.html' %}
          </div>
        </div>
        <div class="col-4">
          <div class="character_feature">
            {% include 'profile/character/info/features.html' %}
          </div>
        </div>
        <div class="col-4">
          <div class="character_traits">
            {% include 'profile/character/info/traits.html' %}
          </div>
        </div>
      </div>
    </div>
    <div class="col-3">
      <div class="card">
        <div class="card-header">
          Skills
        </div>
        <div class="card-body">
          <table class="table table-hover">
            <tbody>
              {% for s in skills.get_skills %}
                <tr>
                  <td><b>{{ s.0 }}</b>: </td> <td style="text-align: right">{{ s.1 }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

</div>
{% endblock %}
{% block bottomscript %}
<script type="text/javascript" src="/static/js/character/character.js"></script>
<script type="text/javascript" src="/static/js/character/character_info.js"></script>
<script type="text/javascript">
  $(document).ready(function() {
    const url = '/profile/{{ user.username }}/character_info/{{ character.id }}/';
    const csrf = '{{ csrf_token }}';
    $(document).on('submit', '.personality_traits_form, .ideals_form, .bonds_form, .flaws_form, .equipment_form', function(e) {
      e.preventDefault();
      var trait = $(this).attr('data-update');
      var description = $('textarea[name="'+trait+'"]').val();
      submit_trait(url, csrf, trait, description);
      return false;
    })

    getInfo();
    $(document).on('click', '.edit', function(e) {
      e.preventDefault();
      var update = $(this).attr('data-update');
      var text = $('.info-text-' + update).text();
      $('.info-text-' + update).hide();
      openEdit(update, text);
      getInfo();
    })
    $(document).on('submit', '.new_feature_form', function() {
      console.log('submit')
      var name = $('input[name="feature_name"]').val(),
          desc = $('textarea[name="feature_desc"]').val();
      addNewFeature(url, csrf, name, desc);
      return false;
    })
    $(document).on('click', '.cancel', function() {
      var update = $(this).attr('data-update');
      $('.info-text-edit-' + update).empty();
      $('.info-text-' + update).show();
    })
  })
</script>
{% endblock %}
